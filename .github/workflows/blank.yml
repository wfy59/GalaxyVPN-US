name: Hourly Update

on:
  schedule:
    - cron: '5 * * * *'  # æ¯å°æ—¶è¿è¡Œä¸€æ¬¡ï¼ˆUTCï¼Œæ¯å°æ—¶05åˆ†ï¼‰
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Update README with timestamp
        run: |
          UTC_TIME=$(date -u +'%Y-%m-%d %H:%M:%S')
          BJ_TIME=$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')
          
          TIMESTAMP_SECTION="\n## ðŸ•’ æœ€åŽæ›´æ–°æ—¶é—´\n\n"
          TIMESTAMP_SECTION+="**UTC**: \`$UTC_TIME\`  \n"
          TIMESTAMP_SECTION+="**åŒ—äº¬æ—¶é—´**: \`$BJ_TIME\`  \n\n"
          TIMESTAMP_SECTION+="> âš¡ æ­¤æ—¶é—´æˆ³ç”± GitHub Actions è‡ªåŠ¨æ›´æ–°\n"
          
          if grep -q "## ðŸ•’ æœ€åŽæ›´æ–°æ—¶é—´" README.md; then
            sed -i '/## ðŸ•’ æœ€åŽæ›´æ–°æ—¶é—´/,/^## \|^# /{//!d}' README.md
            sed -i '/## ðŸ•’ æœ€åŽæ›´æ–°æ—¶é—´/d' README.md
          fi
          
          echo -e "$TIMESTAMP_SECTION" >> README.md
          
      - name: Auto commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Auto deploy by Github Actions"
          commit_user_name: "github-actions[bot]"
          commit_user_email: "github-actions[bot]@users.noreply.github.com"
          file_pattern: README.md
